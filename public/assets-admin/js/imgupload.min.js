/*!
 * bootstrap-imgupload v2.2.0 2016/08/05
 * https://github.com/egonolieux/bootstrap-imgupload
 * Copyright 2016 Egon Olieux
 * Released under the MIT license
 */
!function(a){function c(a){var b=[];return b.push("<div class='alert alert-danger alert-dismissible'>"),b.push("<button type='button' class='close' data-dismiss='alert'>"),b.push("<span>&times;</span>"),b.push("</button>"+a),b.push("</div>"),b.join("")}function d(a){return"<img src='"+a+"' alt='Image preview' class='thumbnail' style='max-width: "+b.previewWidth+"px; max-height: "+b.previewHeight+"px'>"}function e(c,d){var e=new Image;e.onerror=function(){d(!1,"Image could not be found.")},e.onload=function(){var e=c.substr(c.lastIndexOf(".")+1).toLowerCase();a.inArray(e,b.allowedFormats)>-1?d(!0,""):d(!1,"File type is not allowed.")},e.src=c}function f(a){var b=a.closest(".imgupload"),c=b.find(".panel-heading .btn:eq(0)");if(!c.hasClass("active")){var d=b.find(".url-tab");b.find(".panel-heading .btn:eq(1)").removeClass("active"),c.addClass("active"),d.hide(),a.show(),j(d)}}function g(a){a.find(".alert").remove(),a.find(".btn:eq(1)").hide(),a.find(".btn span").text("Browse"),a.find("input").val(""),a.find("img").remove()}function h(e){var f=e.find(".btn:eq(0)"),g=f.find("input");e.find(".alert").remove(),e.find("img").remove();var h=g[0].files&&g[0].files[0];if(h){var i=g[0].files[0];if(i.size/1024>b.maxFileSizeKb)return g.val(""),void e.prepend(c("File is too large (max "+b.maxFileSizeKb+"kB)."));var j=i.name.substr(i.name.lastIndexOf(".")+1).toLowerCase();if(a.inArray(j,b.allowedFormats)>-1){var k=new FileReader;k.onload=function(a){e.append(d(a.target.result))},k.onerror=function(a){g.val(""),e.prepend(c("Error loading image."))},k.readAsDataURL(i),f.find("span").text("Change"),e.find(".btn:eq(1)").css("display","inline-block")}else g.val(""),e.prepend(c("File type is not allowed."))}}function i(a){var b=a.closest(".imgupload"),c=b.find(".panel-heading .btn:eq(1)");if(!c.hasClass("active")){var d=b.find(".file-tab");b.find(".panel-heading .btn:eq(0)").removeClass("active"),c.addClass("active"),d.hide(),a.show(),g(d)}}function j(b){b.find(".alert").remove(),b.find("input").val(""),a.each(b.find(".btn"),function(b,c){"Remove"==a(c).text()?a(c).remove():a(c).text("Submit")}),b.find("img").remove()}function k(b){var f=b.find("input:text").val();if(f){var g=b.find("input:text"),h=b.find(".btn");g.prop("disabled",!0),h.prop("disabled",!0),b.find(".alert").remove(),b.find("img").remove(),e(f,function(e,i){e?(b.find("input:hidden").val(f),b.append(d(f)),1==h.length&&(b.find(".input-group-btn").append("<button type='button' class='btn btn-default'>Remove</button>"),b.find(".btn:eq(1)").on("click",function(){a(this).blur(),b.find(".alert").remove(),b.find("input").val(""),b.find("img").remove(),a(this).remove()}))):(2==h.length&&h[1].remove(),b.prepend(c(i))),g.prop("disabled",!1),h.prop("disabled",!1)})}}var b={allowedFormats:["jpg","jpeg","png","gif"],previewWidth:250,previewHeight:250,maxFileSizeKb:2048};a.fn.imgupload=function(c){if(this.filter("div").hasClass("imgupload")){b=a.extend(b,c);var d=this.find(".file-tab"),e=this.find(".url-tab"),j=this.find(".panel-heading .btn:eq(0)"),l=d.find(".btn:eq(1)"),m=this.find(".panel-heading .btn:eq(1)"),n=e.find(".btn:eq(0)");g(d),f(d),j.off(),d.off("change",".btn:eq(0)"),l.off(),m.off(),n.off(),j.on("click",function(){a(this).blur(),f(d)}),d.on("change",".btn:eq(0)",function(){a(this).blur(),h(d)}),l.on("click",function(){a(this).blur(),g(d)}),m.on("click",function(){a(this).blur(),i(e)}),n.on("click",function(){a(this).blur(),k(e)})}return this}}(jQuery);